# 需求文档

## 介绍

数据拉取与分析系统是一个全栈应用，允许用户从外部API拉取数据，对数据字段进行标注，然后进行数据分析和可视化。系统采用NestJS后端和前端技术栈，使用MySQL数据库存储数据，支持动态表结构以优化查询性能。

## 需求

### 需求 1 - 冒烟测试功能

**用户故事：** 作为数据分析师，我希望能够快速测试API配置的有效性，以便在正式拉取前验证连接和认证。

#### 验收标准

1. 当用户输入API配置时，系统应当提供"测试拉取"按钮进行冒烟测试
2. 当执行冒烟测试时，系统应当不创建任何数据库记录或表结构
3. 当冒烟测试执行时，系统应当只拉取少量样本数据（默认1页）
4. 当冒烟测试完成时，系统应当立即返回成功/失败状态和样本数据
5. 当冒烟测试失败时，系统应当显示具体的错误信息
6. 当冒烟测试成功时，系统应当显示样本数据供用户预览

### 需求 2 - 数据拉取配置功能

**用户故事：** 作为数据分析师，我希望能够灵活配置数据拉取方式，以便根据需要拉取特定范围或全部数据。

#### 验收标准

1. 当用户配置拉取参数时，系统应当提供分页模式和全部模式两种选择
2. 当选择分页模式时，系统应当默认显示分页设置选项
3. 当设置分页参数时，系统应当支持只填写开始页码（拉取单页）
4. 当设置分页参数时，系统应当支持填写开始和结束页码（拉取范围）
5. 当选择全部模式时，系统应当自动拉取所有可用数据直到结束
6. 当配置API时，系统应当允许设置自定义请求头（包括token认证）
7. 当用户需要快速配置时，系统应当提供curl命令解析功能自动填充配置
8. 当解析curl命令时，系统应当提取URL、请求头、查询参数等信息
9. 当配置完成时，系统应当保存配置并创建数据会话

### 需求 3 - 正式数据拉取功能

**用户故事：** 作为数据分析师，我希望能够执行正式数据拉取并将数据按字段存储，以便后续进行高效查询和分析。

#### 验收标准

1. 当开始正式拉取时，系统应当首先分析第一页数据结构
2. 当分析数据结构时，系统应当推断字段类型并创建专用数据表
3. 当创建数据表时，系统应当使用动态表结构以支持高效查询
4. 当拉取数据时，系统应当将数据按字段存储到专用表中
5. 当拉取进行中时，系统应当显示实时进度信息
6. 当拉取完成时，系统应当显示成功提示和数据统计
7. 当数据存储后，系统应当在右侧以分页表格形式展示拉取到的数据
8. 当页面布局时，系统应当采用合理的布局方式，支持上下布局或左右布局，上方/左侧为配置区域，下方/右侧为数据展示区域

### 需求 4 - 字段标注功能

**用户故事：** 作为数据分析师，我希望能够为拉取的数据字段添加标注，以便更好地理解和分析数据。

#### 验收标准

1. 当用户进入标注步骤时，系统应当展示所有数据字段
2. 当显示字段时，系统应当为每个字段提供一个输入框用于输入标注文案
3. 当字段显示时，系统应当根据字段名称自动推断并填入默认标注值
4. 当用户完成标注时，系统应当提供按钮进入下一步骤
5. 当标注保存时，系统应当将字段标注信息存储到数据库
6. 当标注完成时，系统应当验证所有必要字段都已标注

### 需求 5 - 数据分析与可视化功能

**用户故事：** 作为数据分析师，我希望能够筛选和可视化数据，以便发现数据中的模式和趋势。

#### 验收标准

1. 当用户进入分析步骤时，系统应当根据字段类型提供相应的筛选方式
2. 当展示筛选结果时，系统应当提供表格展示和图表展示两种模式
3. 当选择表格展示时，系统应当显示所有字段及其标注信息
4. 当选择图表展示时，系统应当允许用户选择图表类型（折线图、柱状图、饼图）
5. 当配置图表时，系统应当允许用户选择X轴和Y轴对应的字段
6. 当配置图表时，系统应当支持聚合方式选择（求和、平均值、计数）
7. 当生成图表时，系统应当支持保存图表配置供后续使用
8. 当筛选条件改变时，系统应当实时更新图表和表格数据
9. 当用户保存图表时，系统应当提供图表配置管理功能

### 需求 6 - 数据库配置与管理

**用户故事：** 作为系统管理员，我希望系统能够正确连接和管理MySQL数据库，以便可靠地存储和检索数据。

#### 验收标准

1. 当系统启动时，系统应当连接到本地MySQL数据库（用户名：root，密码为空，端口：3306）
2. 当首次运行时，系统应当自动创建必要的数据库和基础表结构
3. 当拉取数据时，系统应当动态创建专用数据表以优化查询性能
4. 当存储数据时，系统应当正确处理不同数据类型的字段映射
5. 当数据库操作失败时，系统应当提供适当的错误处理和回滚机制
6. 当会话结束时，系统应当支持清理相关的动态表（可选）

### 需求 7 - 用户界面与交互

**用户故事：** 作为用户，我希望有一个直观易用的界面来完成整个数据处理流程。

#### 验收标准

1. 当用户访问系统时，系统应当提供清晰的三步骤导航
2. 当在各步骤间切换时，系统应当保持数据状态的一致性
3. 当操作进行中时，系统应当提供适当的加载指示器和进度显示
4. 当发生错误时，系统应当显示用户友好的错误信息
5. 当界面响应时，系统应当支持基本的响应式设计
6. 当用户配置参数时，系统应当提供清晰的选项说明和默认值
7. 当数据量较大时，系统应当支持虚拟滚动和分页加载
8. 当配置项较多时，系统应当支持灵活的布局方式以适应不同屏幕尺寸