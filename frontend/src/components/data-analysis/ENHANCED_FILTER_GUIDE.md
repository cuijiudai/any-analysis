# 增强筛选功能指南

## 功能概述

新的筛选系统根据字段的实际类型智能选择最合适的筛选组件，并支持多种数据类型的筛选。

## 支持的数据类型

### 1. 文本类型
- **类型**: `string`, `text`, `varchar`
- **筛选组件**: 文本输入框
- **操作符**: 等于、不等于、包含、为空、不为空
- **智能检测**: 当唯一值少于20个时，自动切换为枚举选择

### 2. 数字类型
- **类型**: `integer`, `int`, `number`, `decimal`, `float`, `double`
- **筛选组件**: 数值范围选择器
- **操作符**: 等于、不等于、大于、大于等于、小于、小于等于、范围、为空、不为空
- **特性**: 支持滑块和输入框两种方式

### 3. 日期类型
- **类型**: `date`, `datetime`, `timestamp`
- **筛选组件**: 日期选择器/日期范围选择器
- **操作符**: 等于、大于、小于、范围、为空、不为空
- **特性**: 支持单日期和日期范围选择

### 4. 布尔类型
- **类型**: `boolean`, `bool`
- **筛选组件**: 下拉选择框
- **选项**: 是/否
- **操作符**: 等于、为空、不为空

### 5. 枚举类型 ⭐ 新增
- **类型**: `enum` 或智能检测的枚举
- **筛选组件**: 多选下拉框
- **操作符**: 包含、等于、不等于、为空、不为空
- **特性**: 
  - 显示每个值的出现次数
  - 支持搜索功能
  - 最多支持100个选项

### 6. 特殊类型
- **JSON**: `json` - 文本输入框，支持JSON查询
- **URL**: `url` - 文本输入框，针对URL优化
- **Email**: `email` - 文本输入框，针对邮箱地址优化

## 智能类型检测

系统会根据以下规则智能检测字段类型：

### 1. 明确类型匹配
直接根据 `field.type` 匹配预定义的筛选scheme

### 2. 统计信息分析
- **枚举检测**: 唯一值 ≤ 20 且都是字符串 → 枚举类型
- **布尔检测**: 唯一值 ≤ 2 且都是布尔值 → 布尔类型
- **数字检测**: 有min/max统计信息 → 数字类型

### 3. 字段名称模糊匹配
- 包含 `date`, `time`, `created`, `updated` → 日期类型
- 包含 `id`, `count`, `num`, `age`, `price` → 数字类型
- 包含 `is_`, `has_`, `enabled`, `active` → 布尔类型
- 包含 `url`, `link`, `href` → URL类型
- 包含 `email`, `mail` → Email类型

### 4. 类型名称模糊匹配
- 包含 `int`, `num`, `decimal`, `float` → 数字类型
- 包含 `date`, `time` → 日期类型
- 包含 `bool`, `flag` → 布尔类型

## 使用示例

### 枚举类型筛选
```typescript
// 字段定义
{
  name: 'status',
  label: '状态',
  type: 'enum'  // 或者通过智能检测识别
}

// 筛选界面会显示：
// - 多选下拉框
// - 每个选项显示出现次数
// - 支持搜索功能
```

### 智能检测示例
```typescript
// 原始字段类型为 'varchar'，但唯一值只有 ['active', 'inactive', 'pending']
// 系统会自动检测为枚举类型，提供多选下拉框

// 字段名为 'created_at'，类型为 'varchar'
// 系统会根据字段名检测为日期类型，提供日期选择器
```

## 颜色编码

不同类型的字段使用不同颜色的标签：

- 🔵 **蓝色**: 文本类型 (string, text, varchar)
- 🟢 **绿色**: 数字类型 (integer, number, float, etc.)
- 🔵 **青色**: 日期类型 (date, datetime, timestamp)
- 🟣 **紫色**: 布尔类型 (boolean, bool)
- 🟡 **品红**: 枚举类型 (enum)
- 🟠 **橙色**: JSON类型
- 🔷 **极客蓝**: URL类型
- 🔴 **火山红**: Email类型

## 配置选项

### 枚举类型配置
```typescript
enum: {
  type: 'enum',
  component: 'multiSelect',
  operators: ['in', 'eq', 'ne', 'is_null', 'is_not_null'],
  defaultOperator: 'in',
  placeholder: '选择枚举值',
  maxOptions: 100, // 最多100个选项
}
```

### 智能检测阈值
- 枚举检测阈值: 20个唯一值
- 文本转枚举阈值: 20个唯一值

## API支持

### 获取字段枚举值
```http
POST /data-analysis/field-values
{
  "sessionId": "string",
  "fieldName": "string",
  "limit": 100
}
```

### 批量获取字段统计
```http
POST /data-analysis/field-stats
{
  "sessionId": "string",
  "fields": ["field1", "field2"]
}
```

## 最佳实践

1. **明确类型定义**: 尽量在数据源中明确定义字段类型
2. **枚举类型标记**: 对于明确的枚举字段，使用 `enum` 类型
3. **字段命名规范**: 使用有意义的字段名称，帮助智能检测
4. **统计信息完整**: 确保字段统计信息的准确性

这个增强的筛选系统提供了更智能、更灵活的数据筛选体验，能够根据数据的实际特征自动选择最合适的筛选方式。